# zvalid.com

В даному файлі приведено інструкції щодо встановлення, оновлення та видалення вузла з сайту [zvalid.com](https://zvalid.com)
Скріпт встановлює та запускає ноду за допомого. механізмів Docker.

## Встановлення вузла

Щоб встановити вузол виконайте команду:

```shell
wget -q -O aptos.sh https://api.zvalid.com/aptos.sh && chmod +x aptos.sh && sudo /bin/bash aptos.sh
```

Ця команда скачає з сайту `zvalid.com` скріпт встановлення та запустить його під оболонкою `bash`.
Дочекайтесь поки всі команди будуть виконані та з"явиться доступ/запрошення до командної строки.

### Що робить цей скріпт

1. Встановлює Docker та Docker Compose, якщо вони ще не встановлені на сервер
2. Виконується завантаження конфігураційних файлів (docker-compose.yaml, public_full_node.yaml)
3. Виконується завантаження генезіс файлу (genesis.blob) та файлу з точкою шляху (waypoint.txt)
4. Виконується завантаження файлу з початковими сідами
5. Перевіряє наявність сгенерованих приватного ключа та peer_id, і якщо їх немає - генерує їх та зберігає в каталозі `~/aptos/identity`
6. Вносить зміни в конфігураційний файл public_full_node.yaml
7. Запускає контейнер з нодою

### Перевірка стану синхронізації

Щоб перевірити стан сінхронізації вашого вузла, виконайте команду:
```shell
curl 127.0.0.1:9101/metrics 2> /dev/null | grep aptos_state_sync_version | grep type
```

Якщо все гаразд, ви побачете 4 рядкі, що таке:
```shell
aptos_state_sync_version{type="committed"} 206559
aptos_state_sync_version{type="highest"} 206559
aptos_state_sync_version{type="synced"} 206559
aptos_state_sync_version{type="target"} 206560
```

Якщо ви не бачите 4 рядкі, значить щось пішло не так, требі дивитись логі та питати розумних людей ;).

### Перегляд логів роботи вузла

Щоб переглянути логі роботи вузла, виконайте команду:
```shell
docker logs -f aptos-fullnode-1 --tail 5000
```

### Зупинка вузла

Щоб зупинити роботу вузла треба виконати команду:
```shell
docker compose stop
```

## Оновлення ноди

Щоб встановити нову версію ноди:
1. Якщо потрібно збережіть раніше згенеровані ключи та конфігураційні файли
2. Зупиніть ноду
3. Встановіть нову версію за інструкцією вище

